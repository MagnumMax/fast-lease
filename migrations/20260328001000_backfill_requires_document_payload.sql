-- Propagate requires_document from workflow_template defaults into task payload\n+\n+WITH mappings AS (\n+  SELECT * FROM (VALUES\n+    ('collect_buyer_docs_company_v1', false),\n+    ('collect_buyer_docs_individual_v1', false),\n+    ('collect_seller_docs_company_v1', false),\n+    ('collect_seller_docs_individual_v1', false),\n+    ('prepare_quote_v1', false),\n+    ('verify_vehicle_v1', true),\n+    ('pay_supplier_v1', true),\n+    ('doc_signing_v1', true)\n+  ) AS t(template_id, requires_document)\n+)\n+UPDATE tasks AS t\n+SET payload = payload || jsonb_build_object('requires_document', m.requires_document)\n+FROM mappings m\n+WHERE t.payload->>'template_id' = m.template_id;\n*** End Patch
