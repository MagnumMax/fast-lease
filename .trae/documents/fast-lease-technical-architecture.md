# Fast Lease ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

> **üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ü–†–û–¢–û–¢–ò–ü–ê /beta/**
>
> **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –¢–†–ï–ë–û–í–ê–ù–ò–ï**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –î–û–õ–ñ–ù–ê —Å—Ç—Ä–æ–∏—Ç—å—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞ –≤ –ø–∞–ø–∫–µ `/beta/`, –∞ –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å –Ω—É–ª—è!
>
> **–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
>
> * üìÅ **–ü—Ä–æ—Ç–æ—Ç–∏–ø** **`/beta/`** **‚Äî –ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
>
> * üé® **–¢–æ—á–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, API, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ç–æ—Ç–∏–ø
>
> * üîÑ **–¢–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏—è**: –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É ‚Äî —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫
>
> * ‚ö†Ô∏è **–ü—Ä–∏—á–∏–Ω–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã –æ—à–∏–±–æ—á–Ω–æ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å —Å –Ω—É–ª—è –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞
>
> **–ß—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞:**
>
> * –°—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏–∑ `/beta/`
>
> * JavaScript –ª–æ–≥–∏–∫—É –∏–∑ `/beta/components/` –∏ `/beta/assets/shared.js`
>
> * –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ mock-–æ–±—ä–µ–∫—Ç–æ–≤ –≤ HTML —Ñ–∞–π–ª–∞—Ö
>
> * API endpoints, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ç–æ—Ç–∏–ø–µ
>
> * –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
>
> **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –¥–∏–∑–∞–π–Ω

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[Next.js Application]
    B --> C[Supabase]
    
    subgraph "Frontend Layer"
        B
        D[React Components]
        E[Tailwind CSS + Shadcn/ui]
        F[TypeScript]
    end
    
    subgraph "Supabase Backend"
        C
        G[PostgreSQL Database]
        H[Authentication]
        I[Storage]
        J[Realtime]
        K[Edge Functions]
    end
    
    subgraph "External Services"
        L[BKI Scoring API]
        M[Odoo ERP]
        N[Aurora Telematics]
        O[SMS/Email Providers]
    end
    
    B --> D
    B --> E
    B --> F
    C --> G
    C --> H
    C --> I
    C --> J
    C --> K
    K --> L
    K --> M
    K --> N
    K --> O
```

## 2. –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

* **Frontend**: Next.js 14 —Å App Router + React 18
* **Styling**: Tailwind CSS + Shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
* **Language**: TypeScript –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
* **Backend**: Supabase (PostgreSQL + Auth + Storage + Realtime)
* **Authentication**: Supabase Auth —Å MFA –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
* **Storage**: Supabase Storage –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
* **Realtime**: Supabase Realtime –¥–ª—è –∂–∏–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
* **API**: Supabase Edge Functions –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏
* **Charts**: Chart.js –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
* **Drag & Drop**: SortableJS –¥–ª—è –∫–∞–Ω–±–∞–Ω –¥–æ—Å–æ–∫

## 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

| –ú–∞—Ä—à—Ä—É—Ç              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                               |
| -------------------- | ---------------------------------------- |
| /                    | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π |
| /cars/:id            | –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è            |
| /pricing             | –¢–∞—Ä–∏—Ñ—ã –∏ —É—Å–ª–æ–≤–∏—è –ª–∏–∑–∏–Ω–≥–∞                 |
| /login               | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É                 |
| /register            | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è          |
| /apply/start         | –ù–∞—á–∞–ª–æ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏                     |
| /apply/profile       | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∑–∞—è–≤–∏—Ç–µ–ª—è             |
| /apply/documents     | –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤                      |
| /apply/summary       | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏        |
| /apply/status        | –°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏                  |
| /client/dashboard    | –î–∞—à–±–æ—Ä–¥ –∫–ª–∏–µ–Ω—Ç–∞                          |
| /client/invoices     | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏                     |
| /client/vehicle      | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ                 |
| /client/support      | –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏                        |
| /client/referrals    | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞                    |
| /ops/dashboard       | –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥                     |
| /ops/tasks           | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏                      |
| /ops/deals           | –ö–∞–Ω–±–∞–Ω —Å–¥–µ–ª–æ–∫                            |
| /ops/clients         | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏                     |
| /ops/cars            | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–º                    |
| /admin/bpm           | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏             |
| /admin/users         | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏                |
| /admin/integrations  | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π                    |
| /investor/dashboard  | –ò–Ω–≤–µ—Å—Ç–æ—Ä—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥                     |
| /investor/portfolio  | –ü–æ—Ä—Ç—Ñ–µ–ª—å –∞–∫—Ç–∏–≤–æ–≤                         |
| /investor/assets/:id | –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∞                       |
| /investor/reports    | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤                        |

## 4. API –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

### 4.1 Supabase API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Supabase Auth**

```typescript
// Supabase Client SDK
import { createClient } from '@supabase/supabase-js'

const supabase = createClient(url, key)

// –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password'
})
```

**–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ Supabase**

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
const { data: vehicles } = await supabase
  .from('vehicles')
  .select('*')
  .eq('status', 'available')

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
const { data: application } = await supabase
  .from('applications')
  .insert({
    user_id: user.id,
    vehicle_id: vehicleId,
    status: 'draft'
  })

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ Supabase Storage
const { data: file } = await supabase.storage
  .from('documents')
  .upload(`applications/${applicationId}/passport.pdf`, file)
```

**Realtime –ø–æ–¥–ø–∏—Å–∫–∏**

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏
supabase
  .channel('application-updates')
  .on('postgres_changes', {
    event: 'UPDATE',
    schema: 'public',
    table: 'applications',
    filter: `user_id=eq.${userId}`
  }, (payload) => {
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    updateApplicationStatus(payload.new)
  })
  .subscribe()
```

**Edge Functions –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –ª–æ–≥–∏–∫–∏**

```typescript
// /supabase/functions/process-application/index.ts
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts'

serve(async (req) => {
  const { applicationId } = await req.json()
  
  // –í—ã–∑–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö API (BKI, –±–∞–Ω–∫–∏)
  const scoringResult = await callBKIAPI(applicationData)
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î
  await supabase
    .from('applications')
    .update({ 
      status: 'processing',
      scoring_result: scoringResult 
    })
    .eq('id', applicationId)
    
  return new Response(JSON.stringify({ success: true }))
})
```

## 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Supabase

```mermaid
graph TD
    A[Next.js Frontend] --> B[Supabase Client SDK]
    B --> C[Supabase Platform]
    
    subgraph "Supabase Services"
        C --> D[PostgreSQL Database]
        C --> E[Authentication]
        C --> F[Storage]
        C --> G[Realtime]
        C --> H[Edge Functions]
    end
    
    H --> I[External APIs]
    I --> J[BKI Scoring]
    I --> K[Bank APIs]
    I --> L[Telematics]
```

## 6. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### 6.1 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

```mermaid
erDiagram
    USERS ||--o{ APPLICATIONS : creates
    USERS ||--o{ USER_SESSIONS : has
    USERS ||--o{ USER_DOCUMENTS : uploads
    USERS ||--o{ AUDIT_LOGS : generates
    
    APPLICATIONS ||--|| VEHICLES : for
    APPLICATIONS ||--o{ APPLICATION_DOCUMENTS : has
    APPLICATIONS ||--o{ APPLICATION_HISTORY : tracks
    APPLICATIONS ||--|| DEALS : becomes
    
    VEHICLES ||--o{ VEHICLE_SPECIFICATIONS : has
    VEHICLES ||--o{ VEHICLE_IMAGES : has
    VEHICLES ||--o{ VEHICLE_MAINTENANCE : requires
    
    DEALS ||--o{ INVOICES : generates
    DEALS ||--o{ PAYMENTS : receives
    DEALS ||--o{ DEAL_EVENTS : tracks
    DEALS ||--|| INSURANCE_POLICIES : includes
    
    INVOICES ||--o{ PAYMENT_TRANSACTIONS : paid_by
    
    INVESTORS ||--o{ INVESTMENT_PORTFOLIOS : owns
    INVESTMENT_PORTFOLIOS ||--o{ PORTFOLIO_ASSETS : contains
    PORTFOLIO_ASSETS ||--|| DEALS : references
    
    SYSTEM_SETTINGS ||--o{ INTEGRATION_CONFIGS : configures
    INTEGRATION_CONFIGS ||--o{ API_LOGS : logs

    USERS {
        uuid id PK
        string email UK
        string password_hash
        string first_name
        string last_name
        string phone UK
        string emirates_id UK
        string passport_number
        string nationality
        string residency_status
        jsonb address
        string role
        string status
        jsonb preferences
        jsonb kyc_data
        timestamp email_verified_at
        timestamp phone_verified_at
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }
    
    USER_SESSIONS {
        uuid id PK
        uuid user_id FK
        string session_token UK
        string refresh_token UK
        string ip_address
        string user_agent
        jsonb device_info
        timestamp expires_at
        timestamp last_activity
        timestamp created_at
    }
    
    VEHICLES {
        uuid id PK
        string vin UK
        string make
        string model
        string variant
        integer year
        string body_type
        string fuel_type
        string transmission
        decimal engine_capacity
        integer mileage
        string color_exterior
        string color_interior
        decimal purchase_price
        decimal current_value
        decimal monthly_lease_rate
        decimal residual_value
        string status
        jsonb features
        jsonb location_data
        timestamp acquired_at
        timestamp created_at
        timestamp updated_at
    }
    
    VEHICLE_SPECIFICATIONS {
        uuid id PK
        uuid vehicle_id FK
        string category
        string specification_key
        string specification_value
        string unit
        integer sort_order
    }
    
    APPLICATIONS {
        uuid id PK
        string application_number UK
        uuid user_id FK
        uuid vehicle_id FK
        string status
        decimal requested_amount
        integer term_months
        decimal down_payment
        decimal monthly_payment
        decimal interest_rate
        jsonb personal_info
        jsonb financial_info
        jsonb employment_info
        jsonb references_info
        jsonb scoring_results
        jsonb risk_assessment
        string assigned_to
        timestamp submitted_at
        timestamp approved_at
        timestamp rejected_at
        string rejection_reason
        timestamp created_at
        timestamp updated_at
    }
    
    APPLICATION_DOCUMENTS {
        uuid id PK
        uuid application_id FK
        string document_type
        string document_category
        string original_filename
        string stored_filename
        string file_path
        string mime_type
        integer file_size
        string checksum
        string status
        jsonb verification_data
        timestamp uploaded_at
        timestamp verified_at
        string verified_by
    }
    
    DEALS {
        uuid id PK
        string deal_number UK
        uuid application_id FK
        uuid vehicle_id FK
        uuid client_id FK
        string status
        decimal principal_amount
        decimal total_amount
        decimal monthly_payment
        integer term_months
        decimal interest_rate
        decimal down_payment_amount
        decimal security_deposit
        decimal processing_fee
        date contract_start_date
        date contract_end_date
        date first_payment_date
        jsonb contract_terms
        jsonb insurance_details
        string assigned_account_manager
        timestamp activated_at
        timestamp completed_at
        timestamp created_at
        timestamp updated_at
    }
    
    INVOICES {
        uuid id PK
        string invoice_number UK
        uuid deal_id FK
        string invoice_type
        decimal amount
        decimal tax_amount
        decimal total_amount
        string currency
        date due_date
        date issue_date
        string status
        jsonb line_items
        jsonb tax_breakdown
        string payment_terms
        timestamp paid_at
        timestamp created_at
        timestamp updated_at
    }
    
    PAYMENT_TRANSACTIONS {
        uuid id PK
        string transaction_id UK
        uuid invoice_id FK
        uuid deal_id FK
        string payment_method
        string payment_provider
        decimal amount
        string currency
        string status
        jsonb provider_response
        jsonb metadata
        timestamp processed_at
        timestamp created_at
    }
    
    INSURANCE_POLICIES {
        uuid id PK
        string policy_number UK
        uuid deal_id FK
        string provider_name
        string policy_type
        decimal coverage_amount
        decimal premium_amount
        date policy_start_date
        date policy_end_date
        string status
        jsonb coverage_details
        jsonb claims_history
        timestamp created_at
        timestamp updated_at
    }
    
    INVESTORS {
        uuid id PK
        string investor_code UK
        string company_name
        string contact_person
        string email
        string phone
        jsonb address
        string investor_type
        decimal total_investment
        decimal available_funds
        string status
        jsonb compliance_data
        timestamp onboarded_at
        timestamp created_at
        timestamp updated_at
    }
    
    INVESTMENT_PORTFOLIOS {
        uuid id PK
        uuid investor_id FK
        string portfolio_name
        string portfolio_type
        decimal total_value
        decimal allocated_amount
        decimal available_amount
        jsonb risk_parameters
        jsonb performance_metrics
        timestamp created_at
        timestamp updated_at
    }
    
    AUDIT_LOGS {
        uuid id PK
        uuid user_id FK
        string entity_type
        uuid entity_id
        string action
        jsonb old_values
        jsonb new_values
        string ip_address
        string user_agent
        timestamp created_at
    }
    
    SYSTEM_SETTINGS {
        uuid id PK
        string setting_key UK
        string setting_category
        jsonb setting_value
        string description
        boolean is_encrypted
        timestamp updated_at
        string updated_by
    }
    
    INTEGRATION_CONFIGS {
        uuid id PK
        string integration_name UK
        string integration_type
        string endpoint_url
        jsonb authentication_config
        jsonb request_config
        jsonb response_mapping
        boolean is_active
        integer timeout_seconds
        integer retry_attempts
        timestamp last_sync_at
        timestamp created_at
        timestamp updated_at
    }
```

### 6.2 TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
interface User {
  id: string;
  email: string;
  firstName: string;
  lastName: string;
  phone: string;
  emiratesId?: string;
  passportNumber?: string;
  nationality: string;
  residencyStatus: 'resident' | 'non_resident' | 'visitor';
  address: Address;
  role: UserRole;
  status: UserStatus;
  preferences: UserPreferences;
  kycData: KYCData;
  emailVerifiedAt?: Date;
  phoneVerifiedAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}

interface Address {
  street: string;
  city: string;
  emirate: string;
  country: string;
  postalCode?: string;
  coordinates?: {
    latitude: number;
    longitude: number;
  };
}

interface KYCData {
  verificationLevel: 'basic' | 'enhanced' | 'premium';
  documentsVerified: string[];
  riskScore: number;
  sanctionsCheck: boolean;
  pepCheck: boolean;
  lastVerificationDate: Date;
}

// –ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
interface Vehicle {
  id: string;
  vin: string;
  make: string;
  model: string;
  variant: string;
  year: number;
  bodyType: string;
  fuelType: string;
  transmission: string;
  engineCapacity: number;
  mileage: number;
  colorExterior: string;
  colorInterior: string;
  purchasePrice: number;
  currentValue: number;
  monthlyLeaseRate: number;
  residualValue: number;
  status: VehicleStatus;
  features: VehicleFeature[];
  specifications: VehicleSpecification[];
  images: VehicleImage[];
  locationData: LocationData;
  acquiredAt: Date;
  createdAt: Date;
  updatedAt: Date;
}

interface VehicleSpecification {
  id: string;
  vehicleId: string;
  category: string;
  specificationKey: string;
  specificationValue: string;
  unit?: string;
  sortOrder: number;
}

interface VehicleFeature {
  name: string;
  category: string;
  description?: string;
  isStandard: boolean;
}

// –ó–∞—è–≤–∫–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
interface Application {
  id: string;
  applicationNumber: string;
  userId: string;
  vehicleId: string;
  status: ApplicationStatus;
  requestedAmount: number;
  termMonths: number;
  downPayment: number;
  monthlyPayment: number;
  interestRate: number;
  personalInfo: PersonalInfo;
  financialInfo: FinancialInfo;
  employmentInfo: EmploymentInfo;
  referencesInfo: ReferenceInfo[];
  scoringResults?: ScoringResults;
  riskAssessment?: RiskAssessment;
  assignedTo?: string;
  submittedAt?: Date;
  approvedAt?: Date;
  rejectedAt?: Date;
  rejectionReason?: string;
  createdAt: Date;
  updatedAt: Date;
}

interface PersonalInfo {
  firstName: string;
  lastName: string;
  dateOfBirth: Date;
  nationality: string;
  emiratesId?: string;
  passportNumber?: string;
  maritalStatus: string;
  dependents: number;
  address: Address;
  alternativeAddress?: Address;
}

interface FinancialInfo {
  monthlyIncome: number;
  additionalIncome?: number;
  monthlyExpenses: number;
  existingLoans: ExistingLoan[];
  bankStatements: BankStatement[];
  creditScore?: number;
  debtToIncomeRatio: number;
}

interface EmploymentInfo {
  employmentType: 'employed' | 'self_employed' | 'business_owner' | 'retired';
  companyName: string;
  position: string;
  workExperience: number;
  monthlyBasicSalary: number;
  monthlyAllowances: number;
  employerAddress: Address;
  employerContact: ContactInfo;
}

// –°–¥–µ–ª–∫–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å—ã
interface Deal {
  id: string;
  dealNumber: string;
  applicationId: string;
  vehicleId: string;
  clientId: string;
  status: DealStatus;
  principalAmount: number;
  totalAmount: number;
  monthlyPayment: number;
  termMonths: number;
  interestRate: number;
  downPaymentAmount: number;
  securityDeposit: number;
  processingFee: number;
  contractStartDate: Date;
  contractEndDate: Date;
  firstPaymentDate: Date;
  contractTerms: ContractTerms;
  insuranceDetails: InsuranceDetails;
  assignedAccountManager?: string;
  activatedAt?: Date;
  completedAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}

interface Invoice {
  id: string;
  invoiceNumber: string;
  dealId: string;
  invoiceType: 'monthly_payment' | 'down_payment' | 'processing_fee' | 'late_fee' | 'insurance';
  amount: number;
  taxAmount: number;
  totalAmount: number;
  currency: string;
  dueDate: Date;
  issueDate: Date;
  status: InvoiceStatus;
  lineItems: InvoiceLineItem[];
  taxBreakdown: TaxBreakdown[];
  paymentTerms: string;
  paidAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}

interface PaymentTransaction {
  id: string;
  transactionId: string;
  invoiceId: string;
  dealId: string;
  paymentMethod: PaymentMethod;
  paymentProvider: string;
  amount: number;
  currency: string;
  status: PaymentStatus;
  providerResponse: Record<string, any>;
  metadata: Record<string, any>;
  processedAt?: Date;
  createdAt: Date;
}

// –ò–Ω–≤–µ—Å—Ç–æ—Ä—ã –∏ –ø–æ—Ä—Ç—Ñ–µ–ª–∏
interface Investor {
  id: string;
  investorCode: string;
  companyName: string;
  contactPerson: string;
  email: string;
  phone: string;
  address: Address;
  investorType: 'individual' | 'institutional' | 'fund';
  totalInvestment: number;
  availableFunds: number;
  status: InvestorStatus;
  complianceData: ComplianceData;
  onboardedAt: Date;
  createdAt: Date;
  updatedAt: Date;
}

interface InvestmentPortfolio {
  id: string;
  investorId: string;
  portfolioName: string;
  portfolioType: string;
  totalValue: number;
  allocatedAmount: number;
  availableAmount: number;
  riskParameters: RiskParameters;
  performanceMetrics: PerformanceMetrics;
  createdAt: Date;
  updatedAt: Date;
}

// –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∏–ø—ã
interface AuditLog {
  id: string;
  userId: string;
  entityType: string;
  entityId: string;
  action: string;
  oldValues?: Record<string, any>;
  newValues?: Record<string, any>;
  ipAddress: string;
  userAgent: string;
  createdAt: Date;
}

interface SystemSetting {
  id: string;
  settingKey: string;
  settingCategory: string;
  settingValue: Record<string, any>;
  description: string;
  isEncrypted: boolean;
  updatedAt: Date;
  updatedBy: string;
}

// –ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è
type UserRole = 'client' | 'operator' | 'admin' | 'investor' | 'partner';
type UserStatus = 'active' | 'inactive' | 'suspended' | 'pending_verification';
type VehicleStatus = 'available' | 'reserved' | 'leased' | 'maintenance' | 'sold';
type ApplicationStatus = 'draft' | 'submitted' | 'under_review' | 'documents_pending' | 'approved' | 'rejected' | 'expired';
type DealStatus = 'active' | 'completed' | 'defaulted' | 'early_settlement' | 'terminated';
type InvoiceStatus = 'pending' | 'sent' | 'paid' | 'overdue' | 'cancelled';
type PaymentStatus = 'pending' | 'processing' | 'completed' | 'failed' | 'refunded';
type PaymentMethod = 'bank_transfer' | 'credit_card' | 'debit_card' | 'digital_wallet' | 'cash';
type InvestorStatus = 'active' | 'inactive' | 'suspended' | 'under_review';
```

### 6.3 –Ø–∑—ã–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (DDL)

**–°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü**

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    phone VARCHAR(20) UNIQUE,
    emirates_id VARCHAR(20) UNIQUE,
    passport_number VARCHAR(50),
    nationality VARCHAR(100) NOT NULL,
    residency_status VARCHAR(20) DEFAULT 'resident' CHECK (residency_status IN ('resident', 'non_resident', 'visitor')),
    address JSONB NOT NULL,
    role VARCHAR(20) DEFAULT 'client' CHECK (role IN ('client', 'operator', 'admin', 'investor', 'partner')),
    status VARCHAR(20) DEFAULT 'pending_verification' CHECK (status IN ('active', 'inactive', 'suspended', 'pending_verification')),
    preferences JSONB DEFAULT '{}',
    kyc_data JSONB DEFAULT '{}',
    email_verified_at TIMESTAMP WITH TIME ZONE,
    phone_verified_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    deleted_at TIMESTAMP WITH TIME ZONE
);

-- –ê–≤—Ç–æ–º–æ–±–∏–ª–∏
CREATE TABLE vehicles (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    vin VARCHAR(17) UNIQUE NOT NULL,
    make VARCHAR(100) NOT NULL,
    model VARCHAR(100) NOT NULL,
    variant VARCHAR(100),
    year INTEGER NOT NULL CHECK (year >= 2015 AND year <= EXTRACT(YEAR FROM NOW()) + 2),
    body_type VARCHAR(50) NOT NULL,
    fuel_type VARCHAR(30) NOT NULL,
    transmission VARCHAR(30) NOT NULL,
    engine_capacity DECIMAL(4,2),
    mileage INTEGER DEFAULT 0,
    color_exterior VARCHAR(50),
    color_interior VARCHAR(50),
    purchase_price DECIMAL(12,2) NOT NULL,
    current_value DECIMAL(12,2) NOT NULL,
    monthly_lease_rate DECIMAL(10,2) NOT NULL,
    residual_value DECIMAL(12,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'available' CHECK (status IN ('available', 'reserved', 'leased', 'maintenance', 'sold')),
    features JSONB DEFAULT '[]',
    location_data JSONB DEFAULT '{}',
    acquired_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ó–∞—è–≤–∫–∏
CREATE TABLE applications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    application_number VARCHAR(20) UNIQUE NOT NULL,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    vehicle_id UUID NOT NULL REFERENCES vehicles(id),
    status VARCHAR(30) DEFAULT 'draft' CHECK (status IN ('draft', 'submitted', 'under_review', 'documents_pending', 'approved', 'rejected', 'expired')),
    requested_amount DECIMAL(12,2) NOT NULL,
    term_months INTEGER NOT NULL CHECK (term_months BETWEEN 12 AND 84),
    down_payment DECIMAL(12,2) NOT NULL,
    monthly_payment DECIMAL(10,2) NOT NULL,
    interest_rate DECIMAL(5,4) NOT NULL,
    personal_info JSONB NOT NULL,
    financial_info JSONB NOT NULL,
    employment_info JSONB NOT NULL,
    references_info JSONB DEFAULT '[]',
    scoring_results JSONB,
    risk_assessment JSONB,
    assigned_to UUID REFERENCES users(id),
    submitted_at TIMESTAMP WITH TIME ZONE,
    approved_at TIMESTAMP WITH TIME ZONE,
    rejected_at TIMESTAMP WITH TIME ZONE,
    rejection_reason TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –°–¥–µ–ª–∫–∏
CREATE TABLE deals (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    deal_number VARCHAR(20) UNIQUE NOT NULL,
    application_id UUID NOT NULL REFERENCES applications(id),
    vehicle_id UUID NOT NULL REFERENCES vehicles(id),
    client_id UUID NOT NULL REFERENCES users(id),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'completed', 'defaulted', 'early_settlement', 'terminated')),
    principal_amount DECIMAL(12,2) NOT NULL,
    total_amount DECIMAL(12,2) NOT NULL,
    monthly_payment DECIMAL(10,2) NOT NULL,
    term_months INTEGER NOT NULL,
    interest_rate DECIMAL(5,4) NOT NULL,
    down_payment_amount DECIMAL(12,2) NOT NULL,
    security_deposit DECIMAL(10,2) DEFAULT 0,
    processing_fee DECIMAL(8,2) DEFAULT 0,
    contract_start_date DATE NOT NULL,
    contract_end_date DATE NOT NULL,
    first_payment_date DATE NOT NULL,
    contract_terms JSONB NOT NULL,
    insurance_details JSONB NOT NULL,
    assigned_account_manager UUID REFERENCES users(id),
    activated_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_role_status ON users(role, status);
CREATE INDEX idx_users_created_at ON users(created_at DESC);

CREATE INDEX idx_vehicles_make_model ON vehicles(make, model);
CREATE INDEX idx_vehicles_status ON vehicles(status);
CREATE INDEX idx_vehicles_price_range ON vehicles(monthly_lease_rate);

CREATE INDEX idx_applications_user_id ON applications(user_id);
CREATE INDEX idx_applications_status ON applications(status);
CREATE INDEX idx_applications_created_at ON applications(created_at DESC);
CREATE INDEX idx_applications_assigned_to ON applications(assigned_to);

CREATE INDEX idx_deals_client_id ON deals(client_id);
CREATE INDEX idx_deals_status ON deals(status);
CREATE INDEX idx_deals_contract_dates ON deals(contract_start_date, contract_end_date);

-- RLS (Row Level Security) –ø–æ–ª–∏—Ç–∏–∫–∏
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE applications ENABLE ROW LEVEL SECURITY;
ALTER TABLE deals ENABLE ROW LEVEL SECURITY;

-- –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
CREATE POLICY "Users can view own profile" ON users FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Users can update own profile" ON users FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Users can view own applications" ON applications FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Operators can view all applications" ON applications FOR SELECT USING (
    EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND role IN ('operator', 'admin'))
);

-- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ä–æ–ª–µ–π
GRANT SELECT ON users TO anon;
GRANT ALL PRIVILEGES ON users TO authenticated;
GRANT ALL PRIVILEGES ON vehicles TO authenticated;
GRANT ALL PRIVILEGES ON applications TO authenticated;
GRANT ALL PRIVILEGES ON deals TO authenticated;

-- –§—É–Ω–∫—Ü–∏–∏ –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON users FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_vehicles_updated_at BEFORE UPDATE ON vehicles FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_applications_updated_at BEFORE UPDATE ON applications FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
CREATE TRIGGER update_deals_updated_at BEFORE UPDATE ON deals FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

-- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
INSERT INTO users (email, password_hash, first_name, last_name, phone, nationality, address, role, status) VALUES
('admin@fastlease.ae', '$2b$10$example_hash', 'System', 'Administrator', '+971501234567', 'UAE', '{"street": "Sheikh Zayed Road", "city": "Dubai", "emirate": "Dubai", "country": "UAE"}', 'admin', 'active'),
('ops@fastlease.ae', '$2b$10$example_hash', 'Operations', 'Manager', '+971509876543', 'UAE', '{"street": "Business Bay", "city": "Dubai", "emirate": "Dubai", "country": "UAE"}', 'operator', 'active'),
('investor@fund.ae', '$2b$10$example_hash', 'Investment', 'Fund', '+971501111111', 'UAE', '{"street": "DIFC", "city": "Dubai", "emirate": "Dubai", "country": "UAE"}', 'investor', 'active');

INSERT INTO vehicles (vin, make, model, variant, year, body_type, fuel_type, transmission, purchase_price, current_value, monthly_lease_rate, residual_value, features) VALUES
('ZHWUC1ZF9PLA12345', 'Lamborghini', 'Huracan', 'EVO', 2024, 'Coupe', 'Petrol', 'Automatic', 850000.00, 850000.00, 12500.00, 425000.00, '["Carbon Fiber Package", "Sport Exhaust", "Lifting System"]'),
('ZFF80AMA9P0123456', 'Ferrari', '488 Spider', 'Base', 2024, 'Convertible', 'Petrol', 'Automatic', 920000.00, 920000.00, 13800.00, 460000.00, '["Scuderia Ferrari Shields", "Carbon Fiber Steering Wheel", "Premium Audio"]'),
('SJAAA2ZV9PC123456', 'Bentley', 'Bentayga', 'V8', 2024, 'SUV', 'Petrol', 'Automatic', 750000.00, 750000.00, 11200.00, 375000.00, '["Mulliner Package", "Naim Audio", "Panoramic Sunroof"]');
```

