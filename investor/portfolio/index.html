<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fast Lease — Мой портфель</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script>tailwind.config = { theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } } } };</script>
  <link rel="stylesheet" href="../../assets/style.css" />
</head>
<body class="bg-slate-50 font-sans text-slate-900">
  <div class="min-h-screen lg:flex">
    <aside id="sidebar" class="hidden w-72 border-r border-slate-200 bg-white lg:flex"></aside>
    <div class="flex-1">
      <header id="page-header" class="border-b border-slate-200 bg-white/80 px-6 py-5 backdrop-blur"></header>
      <main class="bg-slate-50">
      <div class="mx-auto w-full max-w-6xl lg:ml-0 lg:mr-auto space-y-6">
          <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
              <div>
                <p class="text-xs uppercase tracking-[0.3em] text-slate-400">Мой портфель</p>
                <h1 class="mt-2 text-2xl font-semibold text-slate-900">Активы и метрики</h1>
              </div>
              <div class="flex items-center gap-3">
                <input type="search" id="portfolio-search" placeholder="Поиск по VIN или модели" class="w-60 rounded-xl border-slate-200 text-sm focus:border-slate-900 focus:ring-slate-900" />
                <select id="portfolio-filter" class="rounded-xl border-slate-200 text-sm focus:border-slate-900 focus:ring-slate-900">
                  <option value="all">Все статусы</option>
                  <option value="active">В эксплуатации</option>
                  <option value="pending">На выдаче</option>
                  <option value="attention">Требует внимания</option>
                </select>
              </div>
            </div>
            <div class="mt-6" id="portfolio-table"></div>
          </section>
        </div>
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script type="module">
    async function getShared(basePath) {
      
      const sharedMod = await import(`${basePath}/shared.js`);
      return { ...sharedMod };
    }

    const shared = await getShared('../../assets');
    const { mountSidebar, mountHeader, applyIcons, renderTable, statusBadge, mountMobileBottomNav } = shared;
    const { investorNav } = shared;

    const basePath = '../..';
    mountSidebar({ containerId: 'sidebar', role: 'Инвестор', items: investorNav, activePath: '/investor/portfolio/index.html', basePath });

    mountHeader({
      containerId: 'page-header',
      title: 'Мой портфель',
      breadcrumbs: ['Инвестор', 'Портфель'],
      basePath,
    });

    mountMobileBottomNav({
      containerId: 'mobile-bottom-nav',
      items: investorNav,
      activePath: '/investor/portfolio/index.html',
      basePath,
    });

    const assets = [
      { vin: 'R1T-2204', car: 'Bentley Continental GT', status: 'В эксплуатации', irr: '10.4%', payout: 'AED 4 400', link: '../../investor/assets/asset-001/index.html', type: 'active' },
      { vin: 'AAX-341', car: 'Rolls-Royce Cullinan', status: 'На выдаче', irr: '8.9%', payout: 'AED 3 080', link: '../../investor/assets/asset-001/index.html', type: 'pending' },
      { vin: 'BMW-I4-88', car: 'Ferrari 488 Spider', status: 'В эксплуатации', irr: '9.6%', payout: 'AED 2 680', link: '../../investor/assets/asset-001/index.html', type: 'active' },
      { vin: 'TES-3P-04', car: 'Lamborghini Huracan', status: 'Требует внимания', irr: '7.8%', payout: 'AED 2 530', link: '../../investor/assets/asset-001/index.html', type: 'attention' },
      { vin: 'VOL-XC40-12', car: 'Bentley Bentayga', status: 'В эксплуатации', irr: '9.1%', payout: 'AED 2 170', link: '../../investor/assets/asset-001/index.html', type: 'active' },
    ];

    const columns = [
      { key: 'vin', label: 'VIN', render: (row) => `<a href="${row.link}" class="text-slate-900 hover:underline">${row.vin}</a>` },
      { key: 'car', label: 'Модель' },
      { key: 'status', label: 'Статус', render: (row) => statusBadge(row.status) },
      { key: 'irr', label: 'IRR' },
      { key: 'payout', label: 'Последний платёж' },
    ];

    let searchValue = '';
    let filterValue = 'all';

    function updateTable() {
      const filtered = assets.filter((asset) => {
        const matchesSearch = `${asset.vin} ${asset.car}`.toLowerCase().includes(searchValue.toLowerCase());
        const matchesStatus = filterValue === 'all' || asset.type === filterValue;
        return matchesSearch && matchesStatus;
      });
      renderTable({ containerId: 'portfolio-table', columns, data: filtered });
      setTimeout(() => {
      applyIcons();
    }, 100);
    }

    document.getElementById('portfolio-search').addEventListener('input', (event) => {
      searchValue = event.target.value;
      updateTable();
    });

    document.getElementById('portfolio-filter').addEventListener('change', (event) => {
      filterValue = event.target.value;
      updateTable();
    });

    updateTable();
    applyIcons();
  </script>
  <nav id="mobile-bottom-nav" class="mobile-bottom-nav"></nav>
</body>
</html>
