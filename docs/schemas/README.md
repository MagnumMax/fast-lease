# Schemas

Эталонные схемы БД проекта. Храним здесь актуальные SQL-описания доменов и обновляем при любых изменениях структуры данных.

Рекомендации:
- Включать RLS для таблиц в `public` и писать политики изолировано для `anon`/`authenticated`.
- Для Storage использовать явные политики на `storage.objects` и хелперы `storage.filename()`, `storage.foldername()`.
- Поддерживать индексы на колонках, используемых в политиках RLS и ключевых запросах.
- Версионировать структуру через миграции в `migrations/` (timestamp + краткое название).
- Избегать дублирования: общие типы/enum/функции оформлять централизованно.

Обновление схем:
1. Внести изменения в SQL миграции (`migrations/**/*.sql`).
2. Применить миграции через Supabase MCP (используя `SUPABASE_PROJECT_ID`).
3. Экспортировать обновлённую схему и обновить соответствующие файлы в `docs/schemas/`.

Экспорт схемы (варианты):
- Минимально: поддерживать ручные файлы доменных схем (например, `workflow_schema.sql`).
- Расширенно: сформировать полный `public_schema.sql` (через MCP-запросы к `information_schema` / `pg_catalog`).